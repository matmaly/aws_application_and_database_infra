{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "AWS CloudFormation Root stack",

  "Resources" : {
    "NetworkStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "https://buckettoholdstacks-1646734.s3.amazonaws.com/network_layer.json"
      }
    },
    "IAMStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "https://buckettoholdstacks-1646734.s3.amazonaws.com/iam_layer.json"
      }
    },
    "DBStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "https://buckettoholdstacks-1646734.s3.amazonaws.com/database_layer.json",
        "Parameters": {
          "DBSGID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ProdDBSecurityGroupID"
            ]
          },
          "PrivateSubnet1ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet1ID"
            ]
          },
          "PrivateSubnet2ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet2ID"
            ]
          }
        }
      }
    },
    "ComputeStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "https://buckettoholdstacks-1646734.s3.amazonaws.com/compute_layer.json",
        "Parameters": {
          "ALBSecurityGroupID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ALBSecurityGroupID"
            ]
          },
          "ProdAppSecurityGroupID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ProdAppSecurityGroup"
            ]
          },
          "PublicSubnet1ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PublicSubnet1ID"
            ]
          },
          "PublicSubnet2ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PublicSubnet2ID"
            ]
          },
          "PrivateSubnet1ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet1ID"
            ]
          },
          "PrivateSubnet2ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet2ID"
            ]
          },
          "ApplicationRoleARN": {
            "Fn::GetAtt": [
              "IAMStack",
              "Outputs.ApplicationRoleARN"
            ]
          },
          "ApplicationInstanceProfileARN": {
            "Fn::GetAtt": [
              "IAMStack",
              "Outputs.ApplicationInstanceProfileARN"
            ]
          },
          "VPCID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.VPCID"
            ]
          }
        }
      }
    }
  }
}

