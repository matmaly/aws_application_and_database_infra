{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "AWS CloudFormation Root stack",

  "Resources" : {
    "NetworkStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "network_layer.json"
      }
    },
    "IAMStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "iam_layer.json"
      }
    },
    "DBStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "database_layer.json",
        "Parameters": {
          "DBSGID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ProdDBSecurityGroupID"
            ]
          },
          "PrivateSubnet1ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet1ID"
            ]
          },
          "PrivateSubnet2ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PrivateSubnet2ID"
            ]
          }
        }
      }
    },
    "ComputeStack": {
      "Type": "AWS::CloudFormation::Stack",
      "Properties": {
        "TemplateURL": "compute_layer.json",
        "Parameters": {
          "ALBSecurityGroupID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ALBSecurityGroupID"
            ]
          },
          "AppSecurityGroupID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.ProdAppSecurityGroup"
            ]
          },
          "PublicSubnet1ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PublicSubnet1ID"
            ]
          },
          "PublicSubnet2ID": {
            "Fn::GetAtt": [
              "NetworkStack",
              "Outputs.PublicSubnet2ID"
            ]
          }
        }
      }
    }
  }
}

